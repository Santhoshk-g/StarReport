<template>
    <lightning-card>
    <div class="slds-page-header">
        <div class="slds-page-header__row">
            <div class="slds-page-header__col-title">
            <div class="slds-media">
                <div class="slds-media__figure">
                <span title="opportunity">
                    
                    <lightning-icon icon-name="action:new_note" alternative-text="New note" title="New note" size="xx-small"></lightning-icon>
                    
                    <span class="slds-assistive-text"></span>
                </span>
                </div>
                <div class="slds-media__body">
                <div class="slds-page-header__name">
                    <div class="slds-page-header__name-title">
                    <h1>
                        <span class="slds-page-header__title slds-truncate" title="Rohde Corp - 80,000 Widgets">Stars Report</span>
                    </h1>
                    </div>
                </div>
                <!--<p class="slds-page-header__name-meta">From 2022-12-01 to Till Date</p>-->
                </div>
            </div>
            </div>
             <!--TOTAL RECORDS-->
      <div class="slds-clearfix">
          <div class="slds-align_absolute-center">
              <span class="slds-badge"> Total Records: {total}</span>
          </div>
      </div>
    
            
            
            <lightning-button label="Download" title="Download action" variant="brand" icon-name="utility:download" onclick={exportData} icon-position="right" class="slds-m-left_x-small"></lightning-button>
    &nbsp;&nbsp;
            <lightning-button-icon icon-name="utility:filterList" variant="brand" onclick={showtemplate} class="slds-m-left_x-medium" title="Filters"></lightning-button-icon>              
            <span class="slds-assistive-text">Filters</span>
            
        </div>
        </div>
        
    <lightning-datatable
                        key-field="createdbyId"
                        data={data}
                        columns={columns}
                        onrowaction={handleRowAction}
                        show-row-number-column
                        hide-checkbox-column></lightning-datatable>
                        <div class="slds-text-color_destructive" style="margin-left: 3%">
                        <b>{error}</b>
                    </div>
                        
    <template if:true={loaded}>
            <lightning-spinner alternative-text="Loading"></lightning-spinner>
    </template>                   
    <template if:true={Inspire}>
        <template if:true={Gdata}>
          <div class="slds-scrollable" style="height:30%;width:100%">
          <!--<table class="slds-table slds-table_cell-buffer slds-table_bordered">-->
            <table class="slds-table  ">
            <thead>
                <tr>
                  <th>Project Name</th>
                  <th>Project Code</th>
                  <th>Project Segment</th>
                  <th>Opportunity Name</th>
                  <th>Stage</th>
                  <th>Region</th>
                  <th>SalesArea</th>
                  <th>lead source from</th>
                  <th>Total Est Qty</th> 
                </tr>
            </thead>
            <tbody>
                <template for:each={groupedData} for:item="group">
                  <tr key={group.ProjectName}>
                    <td class="slds-text-title_caps "><b>{group.ProjectName}</b></td>


                    <td>
                      <template for:each={group.oppdata} for:item="person">
                        <div key={person}>{person.ProjectCode}</div>
                      </template>
                    </td>
                    
                    <td>
                      <template for:each={group.oppdata} for:item="person">
                        <div key={person}>{person.ProjectSegment}</div>
                      </template>
                    </td>


                    <td>
                      <template for:each={group.oppdata} for:item="person">
                             
                     <div  key={person}> {person.opportunityName} </div> 
                    </template>
                    </td> 
                    
                    <td>
                        <template for:each={group.oppdata} for:item="person">
                               
                       <div  key={person}>{person.StageName}</div> 
                      </template>
                      </td>  
                    <td>
                        <template for:each={group.oppdata} for:item="person">
                               
                       <div  key={person}> {person.opportunityRegion} </div> 
                      </template>
                    </td> 


                    
                    <td>
                      <template if:true={Infinity} for:each={group.oppdata} for:item="person">
                             
                       <div key={person}>{person.InspireSalesArea}</div>
                      </template> </td>

                      <td>
                        <template for:each={group.oppdata} for:item="person">
                               
                       <div  key={person}>{person.LeadSourcedfrom}</div> 
                      </template>
                    </td> 
                                      
                  
                      <td>
                        <template for:each={group.oppdata} for:item="person">
                               
                       <div key={person}>{person.opptotalEstQty}</div> 
                      </template>
                      </td> 
                    
                  
            
                </tr>
                </template>
            </tbody>
        </table></div></template>
      </template>
      <template if:true={Infinity}>
        <template if:true={Gdata}>
          
          <div class="slds-scrollable" style="height:30%;width:100%">
          <table class=" slds-table ">
            
            <thead>
                <tr>
                    <th>Project Name</th>
                    <th>Project Code</th>
                    <th>Project Segment</th>
                    <th>Opportunity Name</th>
                    <th>Stage</th>
                    <th>Region</th>
                    <th>SalesArea</th>
                    <th>lead source from</th>
                    <th>Total Est Qty</th>
                </tr>
            </thead>
            <tbody>
              <template for:each={groupedData} for:item="group">
                <tr key={group.ProjectName}>
                    <td class="slds-text-title_caps "><b>{group.ProjectName}</b></td>


                    <td>
                      <template for:each={group.oppdata} for:item="person">
                        <div key={person}>{person.ProjectCode}</div>
                      </template>
                    </td>
                    
                    <td>
                      <template for:each={group.oppdata} for:item="person">
                        <div key={person}>{person.ProjectSegment}</div>
                      </template>
                    </td>


                    <td>
                      <template for:each={group.oppdata} for:item="person">
                             
                     <div  key={person}> {person.opportunityName} </div> 
                    </template>
                    </td> 
                    
                    <td>
                        <template for:each={group.oppdata} for:item="person">
                               
                       <div  key={person}>{person.StageName}</div> 
                      </template>
                      </td>  
                    <td>
                        <template for:each={group.oppdata} for:item="person">
                               
                       <div  key={person}> {person.opportunityRegion} </div> 
                      </template>
                    </td> 


                    
                    <td>
                      <template if:true={Infinity} for:each={group.oppdata} for:item="person">
                             
                       <div key={person}>{person.InfinitySalesArea}</div>
                      </template> </td>

                      <td>
                        <template for:each={group.oppdata} for:item="person">
                               
                       <div  key={person}>{person.LeadSourcedfrom}</div> 
                      </template>
                    </td> 
                                      
                  
                      <td>
                        <template for:each={group.oppdata} for:item="person">
                               
                       <div key={person}>{person.opptotalEstQty}</div> 
                      </template>
                      </td> 
                    
                  
            
                </tr>
            </template>
             </tbody>
        </table></div></template>
        <!--PAGE NAVIGATION-->
        <!--<div class="slds-align_absolute-center" style="height:5rem">
          <lightning-button disabled={bDisableFirst} icon-name="utility:jump_to_left" label="First" class="slds-p-horizontal_x-small" alternative-text="first page" onclick={firstPage}></lightning-button>
          <lightning-button disabled={bDisableFirst} icon-name="utility:chevronleft" label="Previous" alternative-text="Previous" onclick={previousPage}></lightning-button>
          &nbsp;
          <span class="slds-badge">Showing {pageNumber} &nbsp;of&nbsp; {totalPages} &nbsp;&nbsp;Page(s)</span>
          &nbsp;
          <lightning-button disabled={bDisableLast} icon-name="utility:chevronright" label="Next" alternative-text="Next" onclick={nextPage} class="slds-p-horizontal_x-small" icon-position="right"></lightning-button>
          <lightning-button disabled={bDisableLast} icon-name="utility:jump_to_right" label="Last" alternative-text="last page" onclick={lastPage} icon-position="right"></lightning-button>
      </div>-->
      <div class="slds-align_absolute-center" style="height:5rem">
        <lightning-button disabled={bDisableFirst} icon-name="utility:left" variant="brand-outline" label="Previous" alternative-text="Previous" onclick={previousPage}></lightning-button>
             &nbsp;&nbsp;
             <span class="slds-badge">Showing {pageNumber} &nbsp;of&nbsp; {totalPages} &nbsp;&nbsp;Pages</span>
             
             <lightning-button disabled={bDisableLast} icon-name="utility:right" variant="brand-outline" label="Next" alternative-text="Next" onclick={nextPage} class="slds-p-horizontal_x-small" icon-position="right"></lightning-button>
    </div>
     
      </template>        
    
    </lightning-card>
    <template if:true={isfilter} >
    
        <!--
            I Used SLDS for this code
            Here is link https://www.lightningdesignsystem.com/components/modals/
        --> 
    
    <section role="dialog"  class="slds-modal slds-fade-in-open">
    <div class="slds-modal__container">
    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={hideModalBox}>
      <lightning-icon icon-name="utility:close"
                      alternative-text="close"
                      variant="inverse"
                      size="small" ></lightning-icon>
      <span class="slds-assistive-text">Close</span>
    </button>
              <!-- modal body start -->
              <lightning-card title="Filters" class="slds-var-p-around_xxx-small">
                <div class="slds-scrollable_y" style="height:36rem; width: 36rem" tabindex="0">
                <div class="slds-p-around_x-small">
                    <span>
                        <template if:true={kam}>
                        <lightning-combobox label="Business" value={recordtype} required="true"
                                            read-only="true"
                                            options={business} onchange={handlebusinessChange}>
                                            </lightning-combobox></template>
                        <template if:true={Nonkam}>
                        <lightning-combobox label="Business" value={recordtype} required="true"
                                            options={business} onchange={handlebusinessChange}>
                                            </lightning-combobox></template>
                        <template if:true={PicklistValues}>                    
                        <lightning-combobox label="Sales Area" value={sales} 
                                            options={PicklistValues}
                                            onchange={handlesalesareaChange}>
                                            </lightning-combobox></template>
                        <!--<c-multi-select-combobox
                                            label="Sales Area"
                                            name="Sales Area"
                                            value={sales}
                                            options={PicklistValues}
                                            onchange = {handlesalesareaChange}></c-multi-select-combobox>
                         <template if:true={PicklistValues2}>                  
                        <lightning-combobox label="Account Type" value={accounttype} 
                                            options={PicklistValues2} onchange={handleaccounttypeChange}>
                                            </lightning-combobox></template>-->
                        <lightning-dual-listbox name="Account Type"
                                          label="Select Account Type"
                                          source-label="Available"
                                          selected-label="Selected"
                                          field-level-help="Select your preferred Account Type"
                                          options={PicklistValues2}
                                          onchange={handleaccounttypeChange}>
                                      </lightning-dual-listbox>
                        <lightning-combobox label="Account Program" value={accprogram} 
                                            options={options} onchange={handleaccprogramChange}>
                                            </lightning-combobox>
                        <lightning-input  type="checkbox" 
                                           label="GlassIcon 2024" onchange={GlassIcon2024} checked={checkvalue}></lightning-input>
                        <lightning-input  type="checkbox" 
                                           label="Star Member SGA" onchange={starmember} checked={isChecked}></lightning-input>
                        
                        <lightning-combobox label="Region" value={oppregion} 
                                          options={PicklistValues4} onchange={handleregionChange}>
                                          </lightning-combobox>
                        <lightning-checkbox-group name="Opportunity Stage"
                                            label="Opportunity Stage"
                                            options={PicklistValues3}
                                            value={value}
                                            onchange={handlestage}></lightning-checkbox-group>
                                  <p><b>Modern Filter</b></p>          
                        <lightning-input  type="checkbox" 
                                            label="Modern Homes" 
                                            onchange={ModernHomeshandler} 
                                            checked={ModernHomes}></lightning-input>
                        <lightning-input  type="checkbox" 
                                            label="Large Builder" 
                                            onchange={LargeBuilderhandler} 
                                            checked={LargeBuilder}></lightning-input>
                        <lightning-input  type="checkbox" 
                                            label="Opportunity Builder" 
                                            onchange={OpportunityBuilder} 
                                            checked={OppBuilder}></lightning-input>
                        
                        <!--<lightning-checkbox-group name="Modren Filter"
                                            label="Modren Filter"
                                            options={getModern}
                                            value={value}
                                            onchange={handleModren}></lightning-checkbox-group>-->
                        <!--<lightning-combobox label="Opportunity Stage" value={accprogram} 
                                            options={PicklistValues3} onchange={handlestage}>
                                            </lightning-combobox>-->
                        
                        <lightning-input label="From Date" 
                                         required="true"
                                         type="date"
                                         value={fromdate}
                                         onchange={fromDateChange}>
                                         </lightning-input>
                        <lightning-input label="To Date" 
                                         required="true"
                                         type="date"
                                         value={todate}
                                         onchange={toDateChange}>
                                         </lightning-input>
                        <br/>
                        <lightning-button label="Submit"
                                          variant="brand" 
                                          class="slds-var-m-around_xx-small"
                                          onclick={submit}></lightning-button>
    
                          <lightning-button variant="destructive" 
                                            label="Close" 
                                            onclick={hideModalBox} 
                                            class="slds-m-right-small">
                                          </lightning-button>
    
                        
                        <!--<template if:true={Gdata}>                  
                        <lightning-button label="Export"
                                          variant="brand"
                                          icon-name="utility:outcome" 
                                          class="slds-var-m-around_xx-small"
                                          onclick={exportData}></lightning-button></template>-->
                        
                  </span>
                </div>
              </div>   
    </lightning-card>
    </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    
    </template>